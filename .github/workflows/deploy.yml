name: Instabot Deployment

on:
    push:
        branches:
            - main
    release:
        types: [ published ]

jobs:
    deploy:
        runs-on: ubuntu-latest
        environment: production
        steps:
            -   name: Deploy to Server
                uses: appleboy/ssh-action@master
                with:
                    host: ${{ secrets.REMOTE_HOST }}
                    username: ${{ secrets.REMOTE_USER }}
                    password: ${{ secrets.REMOTE_PASSWORD }}
                    port: 22
                    script: |
                        ls -lah
                        cd ${{ secrets.REMOTE_TARGET }}
                        ls -lah
                        git pull origin main
                        rm -rf /vendor && rm -rf /var/cache/*
                        composer install --no-dev --optimize-autoloader --no-interaction --no-progress --no-suggest --prefer-dist
